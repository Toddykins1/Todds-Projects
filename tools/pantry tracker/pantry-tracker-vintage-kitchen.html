<!DOCTYPE html>
<html lang="en">
<head>
  <!-- 
    Pantry Tracker - Vintage Kitchen Edition
    A nostalgic food inventory management system with retro styling,
    warm colors, and vintage kitchen aesthetics.
  -->
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pantry Tracker - Vintage Kitchen</title>
  
  <!-- Google Fonts: Vintage, nostalgic typography -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    /* ========================================
       VINTAGE KITCHEN DESIGN SYSTEM
       ======================================== */
    
    :root {
      /* === VINTAGE COLOR PALETTE === */
      --bg: #fdf6e3;           /* Warm cream background */
      --bg-secondary: #f4e4bc; /* Light golden beige */
      --panel: #ffffff;        /* Pure white panels */
      --panel-2: #fefcf7;      /* Soft white */
      --ink: #2c1810;          /* Rich brown text */
      --ink-dim: #8b7355;      /* Muted brown text */
      --line: #d4c4b0;         /* Warm beige borders */
      
      /* === VINTAGE ACCENTS === */
      --accent: #c9a96e;       /* Vintage gold */
      --accent-dim: #b8941f;   /* Darker gold */
      --warning: #d2691e;      /* Burnt orange */
      --danger: #cd5c5c;       /* Vintage red */
      --success: #228b22;      /* Forest green */
      --copper: #b87333;       /* Copper accent */
      --sage: #9caf88;         /* Sage green */
      
      /* === LAYOUT DIMENSIONS === */
      --row-h: 58px;           /* Generous row height */
      --head-h: 80px;          /* Spacious headers */
      
      /* === VISUAL EFFECTS === */
      --radius: 4px;           /* Minimal rounded corners */
      --shadow: 0 4px 8px rgba(44, 24, 16, 0.15);  /* Warm shadow */
      --vintage-shadow: 0 8px 16px rgba(44, 24, 16, 0.2);
    }
    
    /* ========================================
       GLOBAL RESET & BASE STYLES
       ======================================== */
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
    }
    
    body {
      margin: 0;
      background: var(--bg);
      background-image: 
        radial-gradient(circle at 20% 20%, rgba(201, 169, 110, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(156, 175, 136, 0.1) 0%, transparent 50%),
        linear-gradient(45deg, transparent 30%, rgba(244, 228, 188, 0.3) 50%, transparent 70%);
      color: var(--ink);
      font-family: 'Crimson Text', serif;
      letter-spacing: 0.01em;
      line-height: 1.6;
      position: relative;
    }
    
    /* Vintage paper texture */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><filter id="noise"><feTurbulence baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/></filter></defs><rect width="100" height="100" filter="url(%23noise)" opacity="0.1"/></svg>');
      z-index: -1;
    }
    
    /* ========================================
       HEADER SECTION
       ======================================== */
    
    .header {
      background: linear-gradient(135deg, var(--panel) 0%, var(--panel-2) 100%);
      border-bottom: 3px solid var(--accent);
      padding: 32px;
      text-align: center;
      position: relative;
      box-shadow: var(--vintage-shadow);
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--copper), var(--sage), var(--accent));
      background-size: 200% 100%;
      animation: vintageShimmer 3s ease-in-out infinite;
    }
    
    @keyframes vintageShimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .header h1 {
      margin: 0;
      font-family: 'Playfair Display', serif;
      font-size: 36px;
      font-weight: 600;
      color: var(--ink);
      letter-spacing: 0.02em;
      text-shadow: 2px 2px 4px rgba(44, 24, 16, 0.1);
    }
    
    .header p {
      margin: 12px 0 0;
      color: var(--ink-dim);
      font-size: 18px;
      font-style: italic;
    }
    
    /* ========================================
       MAIN CONTAINER LAYOUT
       ======================================== */
    
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px 48px;
    }
    
    /* ========================================
       QUICK ADD SECTION
       ======================================== */
    
    .quick-add {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: var(--radius);
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: var(--vintage-shadow);
      position: relative;
    }
    
    .quick-add::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--copper), var(--accent));
    }
    
    .add-form {
      display: grid;
      grid-template-columns: 2fr auto auto;
      gap: 24px;
      align-items: end;
    }
    
    .food-input {
      padding: 16px 24px;
      border: 2px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel-2);
      color: var(--ink);
      font-size: 18px;
      font-family: 'Crimson Text', serif;
      transition: all 0.3s ease;
    }
    
    .food-input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--panel);
      box-shadow: 0 0 0 3px rgba(201, 169, 110, 0.2);
    }
    
    .food-input::placeholder {
      color: var(--ink-dim);
      opacity: 0.7;
      font-style: italic;
    }
    
    .days-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .days-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-family: 'Playfair Display', serif;
    }
    
    .days-input {
      padding: 16px 20px;
      border: 2px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel-2);
      color: var(--ink);
      font-size: 16px;
      font-family: 'Crimson Text', serif;
      transition: all 0.3s ease;
      width: 120px;
    }
    
    .days-input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--panel);
      box-shadow: 0 0 0 3px rgba(201, 169, 110, 0.2);
    }
    
    .add-btn {
      padding: 16px 32px;
      background: linear-gradient(135deg, var(--accent), var(--copper));
      color: white;
      border: none;
      border-radius: var(--radius);
      font-size: 18px;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: var(--shadow);
    }
    
    .add-btn:hover {
      background: linear-gradient(135deg, var(--accent-dim), var(--accent));
      transform: translateY(-2px);
      box-shadow: var(--vintage-shadow);
    }
    
    .add-btn:disabled {
      background: var(--ink-dim);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========================================
       ALERTS SECTION
       ======================================== */
    
    .alerts-section {
      background: linear-gradient(135deg, rgba(205, 92, 92, 0.1), rgba(210, 105, 30, 0.05));
      border: 2px solid var(--danger);
      border-radius: var(--radius);
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: var(--vintage-shadow);
      position: relative;
    }
    
    .alerts-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--danger), var(--warning), var(--danger));
    }
    
    .alert-header h2 {
      margin: 0 0 20px;
      color: var(--danger);
      font-size: 24px;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      text-shadow: 2px 2px 4px rgba(44, 24, 16, 0.1);
    }
    
    .alerts-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .alert-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: rgba(205, 92, 92, 0.1);
      border: 1px solid var(--danger);
      border-radius: var(--radius);
      font-size: 16px;
      position: relative;
    }
    
    .alert-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--danger);
    }
    
    .alert-item.expired {
      background: rgba(205, 92, 92, 0.15);
      border-color: var(--danger);
    }
    
    .alert-item.expiring-soon {
      background: rgba(210, 105, 30, 0.1);
      border-color: var(--warning);
    }
    
    .alert-text {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .alert-location {
      color: var(--ink-dim);
      font-size: 14px;
      font-style: italic;
    }
    
    /* ========================================
       FOOD LIST SECTION
       ======================================== */
    
    .food-list-section {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: var(--radius);
      box-shadow: var(--vintage-shadow);
      overflow: hidden;
    }
    
    .list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 28px 32px;
      border-bottom: 2px solid var(--accent);
      background: linear-gradient(135deg, var(--panel-2), var(--panel));
    }
    
    .list-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      color: var(--ink);
      text-shadow: 2px 2px 4px rgba(44, 24, 16, 0.1);
    }
    
    .filter-controls {
      display: flex;
      gap: 12px;
    }
    
    .filter-btn {
      padding: 12px 20px;
      border: 2px solid var(--line);
      background: var(--panel-2);
      color: var(--ink-dim);
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .filter-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--panel);
    }
    
    .filter-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      box-shadow: var(--shadow);
    }
    
    .food-list {
      max-height: 600px;
      overflow-y: auto;
    }
    
    .food-list::-webkit-scrollbar {
      width: 12px;
    }
    
    .food-list::-webkit-scrollbar-track {
      background: var(--panel-2);
    }
    
    .food-list::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 6px;
      border: 2px solid var(--panel-2);
    }
    
    .food-list::-webkit-scrollbar-thumb:hover {
      background: var(--accent-dim);
    }
    
    /* ========================================
       FOOD ITEM CARDS
       ======================================== */
    
    .food-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 32px;
      border-bottom: 1px solid var(--line);
      transition: all 0.3s ease;
      position: relative;
      background: var(--panel);
    }
    
    .food-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      background: var(--accent);
      transition: width 0.3s ease;
    }
    
    .food-item:hover::before {
      width: 4px;
    }
    
    .food-item:hover {
      background: var(--panel-2);
    }
    
    .food-item:last-child {
      border-bottom: none;
    }
    
    .food-item.expired {
      background: rgba(205, 92, 92, 0.05);
      border-left: 4px solid var(--danger);
    }
    
    .food-item.expiring-soon {
      background: rgba(210, 105, 30, 0.05);
      border-left: 4px solid var(--warning);
    }
    
    .food-main {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
    }
    
    .food-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--ink);
      font-family: 'Playfair Display', serif;
    }
    
    .food-details {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .expiry-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }
    
    .expiry-date {
      font-size: 14px;
      color: var(--ink-dim);
      font-family: 'Crimson Text', serif;
      font-style: italic;
    }
    
    .days-left {
      font-size: 16px;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: var(--radius);
      font-family: 'Playfair Display', serif;
    }
    
    .days-left.fresh {
      background: rgba(34, 139, 34, 0.1);
      color: var(--success);
      border: 1px solid var(--success);
    }
    
    .days-left.expiring-soon {
      background: rgba(210, 105, 30, 0.1);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
    
    .days-left.expired {
      background: rgba(205, 92, 92, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    /* ========================================
       DELETE BUTTON
       ======================================== */
    
    .delete-btn {
      width: 32px;
      height: 32px;
      border: 2px solid var(--danger);
      background: var(--danger);
      color: white;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-family: 'Playfair Display', serif;
    }
    
    .delete-btn:hover {
      background: white;
      color: var(--danger);
      transform: scale(1.1);
      box-shadow: var(--shadow);
    }
    
    /* ========================================
       RESPONSIVE DESIGN
       ======================================== */
    
    @media (max-width: 768px) {
      .main-container {
        padding: 0 20px 40px;
      }
      
      .add-form {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .days-input-group {
        align-items: stretch;
      }
      
      .days-input {
        width: 100%;
      }
      
      .header {
        padding: 24px 20px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .list-header {
        flex-direction: column;
        gap: 20px;
        align-items: stretch;
      }
      
      .filter-controls {
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .food-item {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
        padding: 20px;
      }
      
      .food-main {
        justify-content: space-between;
      }
      
      .food-details {
        justify-content: space-between;
      }
      
      .expiry-info {
        align-items: flex-start;
      }
    }
    
    /* ========================================
       ANIMATIONS
       ======================================== */
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .food-item {
      animation: fadeIn 0.4s ease-out;
    }
    
    /* ========================================
       STATS DISPLAY
       ======================================== */
    
    .stats-bar {
      display: flex;
      gap: 32px;
      padding: 20px 24px;
      background: linear-gradient(135deg, var(--panel-2), var(--panel));
      border-radius: var(--radius);
      margin-bottom: 24px;
      font-size: 16px;
      border: 1px solid var(--accent);
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }
    
    .stat-item::after {
      content: '';
      position: absolute;
      right: -16px;
      top: 50%;
      transform: translateY(-50%);
      width: 1px;
      height: 20px;
      background: var(--accent);
      opacity: 0.3;
    }
    
    .stat-item:last-child::after {
      display: none;
    }
    
    .stat-number {
      font-weight: 600;
      color: var(--accent);
      font-family: 'Playfair Display', serif;
      font-size: 18px;
    }
    
    .stat-label {
      color: var(--ink-dim);
      font-family: 'Crimson Text', serif;
      font-style: italic;
    }
    
    /* ========================================
       UTILITY CLASSES
       ======================================== */
    
    .text-center { text-align: center; }
    .text-muted { color: var(--ink-dim); }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
  </style>
</head>
<body>
  <header class="header">
    <h1>🏠 Grandma's Pantry Tracker</h1>
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-number" id="totalItems">0</span>
        <span class="stat-label">Total Items</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="expiringCount">0</span>
        <span class="stat-label">Expiring Soon</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="expiredCount">0</span>
        <span class="stat-label">Expired</span>
      </div>
    </div>
  </header>

  <main class="main-container">
    
    <!-- ========================================
         QUICK ADD SECTION (ALWAYS VISIBLE)
         ======================================== -->
    <section class="quick-add">
      <div class="add-form">
        <input 
          id="foodName" 
          class="food-input" 
          type="text" 
          placeholder="What did you bring home from the market? (e.g., Fresh Milk, Homemade Bread, Garden Apples)"
          maxlength="50"
        />
        <div class="days-input-group">
          <label class="days-label">⏰ Days Until Expiry</label>
          <input 
            id="daysInput" 
            class="days-input" 
            type="number"
            min="1"
            max="365"
            placeholder="7"
            title="How many days until this food expires?"
          />
        </div>
        <button id="addFoodBtn" class="add-btn">Add to Pantry</button>
      </div>
    </section>
    
    <!-- ========================================
         EXPIRING ALERTS (PROMINENT)
         ======================================== -->
    <section class="alerts-section" id="alertsSection" style="display: none;">
      <div class="alert-header">
        <h2>⚠️ Attention Needed</h2>
      </div>
      <div class="alerts-list" id="alertsList">
        <!-- Alert items will be dynamically inserted here -->
      </div>
    </section>
    
    <!-- ========================================
         MAIN FOOD LIST
         ======================================== -->
    <section class="food-list-section">
      <div class="list-header">
        <h2>Kitchen Pantry Inventory</h2>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter="all">All Items</button>
          <button class="filter-btn" data-filter="expired">🗑️ Expired</button>
          <button class="filter-btn" data-filter="expiring">⚠️ Expiring</button>
          <button class="filter-btn" data-filter="shelf-stable">🥫 Shelf Stable</button>
        </div>
      </div>
      
      <div class="food-list" id="foodList">
        <!-- Food items will be dynamically inserted here -->
      </div>
    </section>
    
  </main>

  <script>
    /* ========================================
       DOM MANIPULATION UTILITIES
       ======================================== */
    
    const $ = id => document.getElementById(id);
    
    const el = (tag, attrs = {}, kids = []) => {
      const n = document.createElement(tag);
      
      for (const k in attrs) {
        if (k === 'style') {
          Object.assign(n.style, attrs.style);
        } else if (k === 'dataset') {
          Object.assign(n.dataset, attrs.dataset);
        } else {
          n[k] = attrs[k];
        }
      }
      
      kids.forEach(ch => n.appendChild(ch));
      return n;
    };
    
    const replace = (node, children) => node.replaceChildren(...children);

    /* ========================================
       APPLICATION STATE
       ======================================== */
    
    const state = {
      foods: {},                    // Food storage: {id: {name, purchaseDate, expiryDate}}
      currentFilter: 'all'          // Current filter: 'all', 'expired', 'expiring', 'shelf-stable'
    };
    
    const MIN_VISIBLE_ROWS = 8;

    /* ========================================
       DOM ELEMENT REFERENCES
       ======================================== */
    
    const els = {
      foodName: $('foodName'),
      daysInput: $('daysInput'),
      addBtn: $('addFoodBtn'),
      totalItems: $('totalItems'),
      expiringCount: $('expiringCount'),
      expiredCount: $('expiredCount'),
      alertsSection: $('alertsSection'),
      alertsList: $('alertsList'),
      foodList: $('foodList')
    };

    /* ========================================
       UTILITY FUNCTIONS
       ======================================== */
    
    const uid = () => 'f' + Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    
    /**
     * Calculates days between two dates
     * @param {Date} date1 - First date
     * @param {Date} date2 - Second date
     * @returns {number} Days difference
     */
    const daysBetween = (date1, date2) => {
      const oneDay = 24 * 60 * 60 * 1000;
      return Math.round((date2 - date1) / oneDay);
    };
    
    /**
     * Gets expiry status for a food item
     * @param {string} expiryDate - Expiry date string
     * @returns {Object} Status object with type and days
     */
    const getExpiryStatus = (expiryDate) => {
      const today = new Date();
      const expiry = new Date(expiryDate);
      const daysLeft = daysBetween(today, expiry);
      
      if (daysLeft < 0) {
        return { type: 'expired', days: Math.abs(daysLeft) };
      } else if (daysLeft <= 3) {
        return { type: 'expiring-soon', days: daysLeft };
      } else {
        return { type: 'fresh', days: daysLeft };
      }
    };
    
    /**
     * Formats date for display
     * @param {string} dateString - Date string
     * @returns {string} Formatted date
     */
    const formatDate = (dateString) => {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric' 
      });
    };

    /* ========================================
       FOOD MANAGEMENT FUNCTIONS
       ======================================== */
    
    /**
     * Adds a new food item
     */
    function addFoodItem() {
      const name = els.foodName.value.trim();
      const days = parseInt(els.daysInput.value) || 7; // Default to 7 if empty
      
      if (!name) {
        alert('Please enter a food name');
        return;
      }
      
      if (days < 1) {
        alert('Days must be 1 or more');
        return;
      }
      
      const today = new Date();
      const purchaseDate = today.toISOString().split('T')[0];
      
      // Calculate expiry date by adding days to today
      const expiryDate = new Date(today.getTime() + days * 24 * 60 * 60 * 1000);
      const expiryDateString = expiryDate.toISOString().split('T')[0];
      
      const id = uid();
      
      state.foods[id] = {
        name,
        purchaseDate,
        expiryDate: expiryDateString
      };
      
      // Clear form
      els.foodName.value = '';
      els.daysInput.value = '';
      
      // Focus back on food name for quick entry
      els.foodName.focus();
      
      renderAll();
      saveToStorage();
    }

    /**
     * Creates a food chip element
     * @param {string} id - Food ID
     * @returns {HTMLElement} Food chip element
     */
    const chipFor = id => {
      const food = state.foods[id];
      
      if (!food) {
        console.warn(`Food with id ${id} not found in state.foods`);
        return el('span', {
          className: 'food-chip',
          textContent: '[Food not found]'
        });
      }
      
      const chip = el('span', { 
        className: `food-chip` 
      });
      chip.textContent = food.name;
      return chip;
    };

    /**
     * Deletes a food item
     * @param {string} id - Food ID to delete
     */
    function deleteFoodItem(id) {
      if (!state.foods[id]) return;
      
      delete state.foods[id];
      renderAll();
      saveToStorage();
    }
    
    /**
     * Gets filtered food items based on current filter
     * @returns {Array} Array of food IDs
     */
    function getFilteredFoods() {
      const allFoods = Object.keys(state.foods);
      
      if (state.currentFilter === 'all') {
        return allFoods;
      } else if (state.currentFilter === 'expired') {
        return allFoods.filter(id => {
          const status = getExpiryStatus(state.foods[id].expiryDate);
          return status.type === 'expired';
        });
      } else if (state.currentFilter === 'expiring') {
        return allFoods.filter(id => {
          const status = getExpiryStatus(state.foods[id].expiryDate);
          return status.type === 'expiring-soon';
        });
      } else if (state.currentFilter === 'shelf-stable') {
        return allFoods.filter(id => {
          const status = getExpiryStatus(state.foods[id].expiryDate);
          return status.type === 'fresh' && status.days > 30;
        });
      }
      
      return allFoods;
    }

    /* ========================================
       RENDERING SYSTEM
       ======================================== */
    
    /**
     * Updates the statistics display
     */
    function updateStats() {
      const totalItems = Object.keys(state.foods).length;
      let expiringCount = 0;
      let expiredCount = 0;
      
      Object.values(state.foods).forEach(food => {
        const status = getExpiryStatus(food.expiryDate);
        if (status.type === 'expiring-soon') {
          expiringCount++;
        } else if (status.type === 'expired') {
          expiredCount++;
        }
      });
      
      els.totalItems.textContent = totalItems;
      els.expiringCount.textContent = expiringCount;
      els.expiredCount.textContent = expiredCount;
    }

    /**
     * Re-renders all sections
     */
    function renderAll() {
      updateStats();
      renderAlerts();
      renderFoodList();
    }

    /**
     * Renders the alerts section
     */
    function renderAlerts() {
      const expiringFoods = Object.keys(state.foods).filter(id => {
        const status = getExpiryStatus(state.foods[id].expiryDate);
        return status.type === 'expired' || status.type === 'expiring-soon';
      });
      
      if (expiringFoods.length === 0) {
        els.alertsSection.style.display = 'none';
        return;
      }
      
      els.alertsSection.style.display = 'block';
      
      const alertItems = expiringFoods.map(id => {
        const food = state.foods[id];
        const status = getExpiryStatus(food.expiryDate);
        
        const alertItem = el('div', {
          className: `alert-item ${status.type}`
        });
        
        const alertText = el('div', { className: 'alert-text' });
        alertText.innerHTML = `
          <strong>${food.name}</strong>
        `;
        
        const alertAction = el('div', {
          textContent: status.type === 'expired' 
            ? `Expired ${status.days} day${status.days !== 1 ? 's' : ''} ago`
            : `Expires in ${status.days} day${status.days !== 1 ? 's' : ''}`
        });
        
        alertItem.appendChild(alertText);
        alertItem.appendChild(alertAction);
        
        return alertItem;
      });
      
      replace(els.alertsList, alertItems);
    }

    /**
     * Renders the main food list
     */
    function renderFoodList() {
      const filteredIds = getFilteredFoods();
      
      // Sort by expiry date (soonest first)
      filteredIds.sort((a, b) => {
        const dateA = new Date(state.foods[a].expiryDate);
        const dateB = new Date(state.foods[b].expiryDate);
        return dateA - dateB;
      });
      
      const foodItems = filteredIds.map(id => {
        const food = state.foods[id];
        const status = getExpiryStatus(food.expiryDate);
        
        const foodItem = el('div', {
          className: `food-item ${status.type}`
        });
        
        const foodMain = el('div', { className: 'food-main' });
        foodMain.innerHTML = `
          <span class="food-name">${food.name}</span>
        `;
        
        const foodDetails = el('div', { className: 'food-details' });
        foodDetails.innerHTML = `
          <div class="expiry-info">
            <span class="expiry-date">Expires ${formatDate(food.expiryDate)}</span>
            <span class="days-left ${status.type}">
              ${status.type === 'expired' ? `-${status.days}d` : `${status.days}d left`}
            </span>
          </div>
          <button class="delete-btn" title="Remove from pantry">×</button>
        `;
        
        const deleteBtn = foodDetails.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteFoodItem(id);
        });
        
        foodItem.appendChild(foodMain);
        foodItem.appendChild(foodDetails);
        
        return foodItem;
      });
      
      replace(els.foodList, foodItems);
    }

    /* ========================================
       FILTER SYSTEM
       ======================================== */
    
    function setFilter(filter) {
      state.currentFilter = filter;
      
      // Update filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
      
      renderFoodList();
    }

    /* ========================================
       LOCAL STORAGE
       ======================================== */
    
    function saveToStorage() {
      localStorage.setItem('pantry-tracker-vintage-data', JSON.stringify(state));
    }
    
    function loadFromStorage() {
      const saved = localStorage.getItem('pantry-tracker-vintage-data');
      if (saved) {
        const parsed = JSON.parse(saved);
        state.foods = parsed.foods || {};
        state.currentFilter = parsed.currentFilter || 'all';
      } else {
        // Add some sample data for first-time users
        addSampleData();
      }
    }
    
    function addSampleData() {
      const today = new Date();
      const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
      const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
      const nextMonth = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
      
      const sampleFoods = [
        { name: 'Fresh Milk', purchaseDate: today.toISOString().split('T')[0], expiryDate: tomorrow.toISOString().split('T')[0] },
        { name: 'Homemade Bread', purchaseDate: today.toISOString().split('T')[0], expiryDate: nextWeek.toISOString().split('T')[0] },
        { name: 'Garden Apples', purchaseDate: today.toISOString().split('T')[0], expiryDate: nextWeek.toISOString().split('T')[0] },
        { name: 'Basmati Rice', purchaseDate: today.toISOString().split('T')[0], expiryDate: nextMonth.toISOString().split('T')[0] },
        { name: 'Artisan Yogurt', purchaseDate: today.toISOString().split('T')[0], expiryDate: tomorrow.toISOString().split('T')[0] }
      ];
      
      sampleFoods.forEach(food => {
        const id = uid();
        state.foods[id] = food;
      });
      
      saveToStorage();
    }

    /* ========================================
       INPUT HANDLING
       ======================================== */
    
    els.addBtn.addEventListener('click', addFoodItem);
    
    // Add food on Enter key
    [els.foodName, els.daysInput].forEach(input => {
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          addFoodItem();
        }
      });
    });
    
    // Set default days value
    els.daysInput.value = '7';
    
    // Filter button handlers
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        setFilter(btn.dataset.filter);
      });
    });

    /* ========================================
       APPLICATION INITIALIZATION
       ======================================== */
    
    function init() {
      loadFromStorage();
      renderAll();
      
      // Set initial filter
      setFilter(state.currentFilter);
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
  </script>
</body>
</html>
